<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>My Blockly Playground</title>
    <script src="../../blockly_uncompressed.js"></script>
    <script src="../../generators/javascript.js"></script>
    <script src="../../generators/javascript/logic.js"></script>
    <script src="../../generators/javascript/loops.js"></script>
    <script src="../../generators/javascript/math.js"></script>
    <script src="../../generators/javascript/text.js"></script>
    <script src="../../generators/javascript/lists.js"></script>
    <script src="../../generators/javascript/colour.js"></script>
    <script src="../../generators/javascript/variables.js"></script>
    <script src="../../generators/javascript/variables_dynamic.js"></script>
    <script src="../../generators/javascript/procedures.js"></script>
    <script src="../../generators/python.js"></script>
    <script src="../../generators/python/logic.js"></script>
    <script src="../../generators/python/loops.js"></script>
    <script src="../../generators/python/math.js"></script>
    <script src="../../generators/python/text.js"></script>
    <script src="../../generators/python/lists.js"></script>
    <script src="../../generators/python/colour.js"></script>
    <script src="../../generators/python/variables.js"></script>
    <script src="../../generators/python/variables_dynamic.js"></script>
    <script src="../../generators/python/procedures.js"></script>
    <script src="../../generators/php.js"></script>
    <script src="../../generators/php/logic.js"></script>
    <script src="../../generators/php/loops.js"></script>
    <script src="../../generators/php/math.js"></script>
    <script src="../../generators/php/text.js"></script>
    <script src="../../generators/php/lists.js"></script>
    <script src="../../generators/php/colour.js"></script>
    <script src="../../generators/php/variables.js"></script>
    <script src="../../generators/php/variables_dynamic.js"></script>
    <script src="../../generators/php/procedures.js"></script>
    <script src="../../generators/lua.js"></script>
    <script src="../../generators/lua/logic.js"></script>
    <script src="../../generators/lua/loops.js"></script>
    <script src="../../generators/lua/math.js"></script>
    <script src="../../generators/lua/text.js"></script>
    <script src="../../generators/lua/lists.js"></script>
    <script src="../../generators/lua/colour.js"></script>
    <script src="../../generators/lua/variables.js"></script>
    <script src="../../generators/lua/variables_dynamic.js"></script>
    <script src="../../generators/lua/procedures.js"></script>
    <script src="../../generators/dart.js"></script>
    <script src="../../generators/dart/logic.js"></script>
    <script src="../../generators/dart/loops.js"></script>
    <script src="../../generators/dart/math.js"></script>
    <script src="../../generators/dart/text.js"></script>
    <script src="../../generators/dart/lists.js"></script>
    <script src="../../generators/dart/colour.js"></script>
    <script src="../../generators/dart/variables.js"></script>
    <script src="../../generators/dart/variables_dynamic.js"></script>
    <script src="../../generators/dart/procedures.js"></script>
    <script src="../../msg/messages.js"></script>
    <script src="../../blocks/logic.js"></script>
    <script src="../../blocks/loops.js"></script>
    <script src="../../blocks/math.js"></script>
    <script src="../../blocks/text.js"></script>
    <script src="../../blocks/lists.js"></script>
    <script src="../../blocks/colour.js"></script>
    <script src="../../blocks/variables.js"></script>
    <script src="../../blocks/variables_dynamic.js"></script>
    <script src="../../blocks/procedures.js"></script>
    <script src="plus-minus-blocks.js"></script>
    <script src="field_plus.js"></script>
    <script src="field_minus.js"></script>
  </head>
  <body onload="start()">

    <!--style="height: 100px"-->
    <div id="blocklyDiv"></div>

    <div id="toolsDiv">
      <div style="flex-grow: 0;">
        <h1>My Blockly Playground</h1>

        <p><a href="javascript:void(workspace.setVisible(true))">Show</a>
          - <a href="javascript:void(workspace.setVisible(false))">Hide</a></p>
        <br>
        <form id="options">
          <div class="bundle">
            <select class="bundle--item" id="dir" name="dir" onchange="document.forms.options.submit()">
              <option value="ltr">LTR</option>
              <option value="rtl">RTL</option>
            </select>
            <select class="bundle--item" id="toolbox" name="toolbox" onchange="document.forms.options.submit()">
              <option class="toolbox-opt" value="categories">Categories (untyped variables)</option>
              <option class="toolbox-opt" value="categories-typed-variables">Categories (typed variables)</option>
              <option class="toolbox-opt" value="simple">Simple</option>
              <option class="toolbox-opt" value="test-blocks">Test Blocks</option>
              <option class="toolbox-opt" value="summit-fields">Summit Fields</option>
            </select>
            <select class="bundle--item" id="side" name="side" onchange="document.forms.options.submit()">
              <option value="start">Start</option>
              <option value="end">End</option>
              <option value="top">Top</option>
              <option value="bottom">Bottom</option>
            </select>
            <select class="bundle--item" id="themeChanger" name="theme" onchange="changeTheme()">
              <option value="classic">Classic</option>
              <option value="modern">Modern</option>
              <option value="high_contrast">High Contrast</option>
            </select>
          </div>
          <br>
          <p>
            Stress test: &nbsp;
            <input type="button" value="Airstrike!" onclick="airstrike(100)">
            <input type="button" value="Spaghetti!" onclick="spaghetti(8)">
            <input type="button" value="Memory Strike!" onclick="memoryStrike(1)">
            <input type="button" value="Misc Stress!" onclick="miscStressTest()">
          </p>
          <br>
          <p>
            Log events: &nbsp;
            <input type="checkbox" onclick="logEvents(this.checked)" id="logCheck">
          </p>
          <br>
          <div class="bundle">
            <span id="auto-update-text">Auto Update &nbsp;</span>
            <input class="bundle&#45;&#45;item" type="checkbox" id="auto-update" checked onclick="setAutoUpdate(this.checked)"/>

            <div id="break" style="width: 100%; display: none;"></div>
            <input class="bundle--item" type="button" id="import" value="Import" style="display: none;" onclick="fromXml()" id="import"/>
            <input class="bundle--item" type="button" id="export" value="Export to" style="display: none;" onclick="exportWorkspace()"/>
            <select class="bundle--item" id="export-type" name="export" onchange="exportWorkspace();">
              <option class="export-opt" value="clean-xml">Clean XML</option>
              <option class="export-opt" value="xml">XML</option>
              <option class="export-opt" value="JavaScript">JavaScript</option>
              <option class="export-opt" value="Python">Python</option>
              <option class="export-opt" value="PHP">PHP</option>
              <option class="export-opt" value="Lua">Lua</option>
              <option class="export-opt" value="Dart">Dart</option>
            </select>
          </div>
        </form>
      </div>
      <textarea id="importExport" style="
          width: calc(100% - 20px);
          flex-grow: 1;"
                onchange="textAreaChange();" onkeyup="textAreaChange()"></textarea>
    </div>


    <style>
      html {
        height: 100%;
      }
      body {
        height: calc(100% - 2em);
        background-color: #40E0D0;
        font-family: sans-serif;
        overflow: hidden;
        margin: 1em;
        display: flex;
        flex-direction: row-reverse;
      }
      p {
        margin: 0;
      }
      .blocklyMinimalBody {
        height: 100%;
      }
      h1 {
        font-weight: normal;
        font-size: 140%;
        margin-top: 0;
      }
      #toolsDiv {
        height: 100%;
        width: 30%;
        min-width: 250px;
        display: flex;
        flex-direction: column;
        flex-grow: 0;
      }
      #blocklyDiv {
        float: right;
        height: 100%;
        width: 70%;
        flex-grow: 1;
      }
      #importExport {
        font-family: monospace;
      }
      .ioLabel>.blocklyFlyoutLabelText {
        font-style: italic;
      }
      .bundle {
        display: flex;
        flex-wrap: wrap;
      }
      .bundle--item {
        margin: 3px 3px 3px 0;
      }
      div[role=treeitem][aria-level="2"] {
        margin-left: 24px;
      }
      div[role=treeitem][aria-level="2"] .blocklyTreeRow {
        padding-left: 3px !important;
      }
      div[role=treeitem][aria-level="2"] .blocklyTreeIcon {
        display: none !important;
      }

      .modifiesFlyout {
        fill: #66CC88;
        cursor: default;
      }
      .modifiesFlyout .blocklyFlyoutButtonShadow {
        fill: #59B377;
      }
      .modifiesFlyout:hover {
        fill: #73E699;
      }

      .modifiesWorkspace {
        fill: #CC6666;
        cursor: default;
      }
      .modifiesWorkspace .blocklyFlyoutButtonShadow {
        fill: #B35959;
      }
      .modifiesWorkspace:hover {
        fill: #E67373;
      }

      .text {
        fill: red !important;
      }

      .blocklyDatePicker,
      .blocklyDatePicker th,
      .blocklyDatePicker td {
        font: 13px Arial, sans-serif;
      }
    </style>

    <script>
      'use strict';
      var workspace = null;

      function changeTheme() {
        var theme = document.getElementById('themeChanger').value;
        if (sessionStorage) {
          sessionStorage.setItem('theme', theme);
        }
        if (theme == "modern") {
          Blockly.setTheme(Blockly.Themes.Modern);
        } else if (theme == "high_contrast") {
          Blockly.setTheme(Blockly.Themes.HighContrast);
        } else {
          Blockly.setTheme(new Blockly.Theme(blockStyles, categoryStyles));
        }
      }

      function getToolboxElement() {
        var match = location.search.match(/toolbox=([^&]+)/);
        // Default to the basic toolbox with categories and untyped variables,
        // but override that if the toolbox type is set in the URL.
        var toolboxSuffix = (match ? match[1] : 'categories');
        return document.getElementById('toolbox-' + toolboxSuffix);
      }

      function getOpts(selector) {
        var toolboxes = document.querySelectorAll(selector);
        var opts = [];
        for(var i = 0, toolbox; toolbox = toolboxes[i]; i++) {
          opts.push(toolbox.value);
        }
        return opts;
      }

      function exportWorkspace() {
        var type = document.getElementById('export-type').value;
        if (sessionStorage) {
          sessionStorage.setItem('exportType', type);
        }
        var output = document.getElementById('importExport');
        switch (type) {
          case 'clean-xml':
            var xml = Blockly.Xml.workspaceToDom(workspace);
            var xml = cleanXml(xml);
            output.value = Blockly.Xml.domToPrettyText(xml);
            break;
          case 'xml':
            var xml = Blockly.Xml.workspaceToDom(workspace);
            output.value = Blockly.Xml.domToPrettyText(xml);
            break;
          default:
            output.value = Blockly[type].workspaceToCode(workspace);
            break;
        }
        textAreaChange();
      }

      function cleanXml(xml) {
        var newXml = xml.cloneNode(true);
        var node = newXml;
        while (node) {
          // Things like text inside tags are still treated as nodes, but they
          // don't have attributes (or the removeAttribute function) so we can
          // skip removing attributes from them.
          if (node.removeAttribute) {
            node.removeAttribute('x');
            node.removeAttribute('y');
            node.removeAttribute('id');
          }

          // Try to go down the tree
          var nextNode = node.firstChild || node.nextSibling;
          // If we can't go down, try to go back up the tree.
          if (!nextNode) {
            nextNode = node.parentNode;
            while (nextNode) {
              // We are valid again!
              if (nextNode.nextSibling) {
                nextNode = nextNode.nextSibling;
                break;
              }
              // Try going up again. If parentNode is null that means we have
              // reached the top, and we will break out of both loops.
              nextNode = nextNode.parentNode;
            }
          }
          node = nextNode;
        }
        return newXml;
      }

      function fromXml() {
        var input = document.getElementById('importExport');
        var xml = Blockly.Xml.textToDom(input.value);
        Blockly.Xml.domToWorkspace(xml, workspace);
        textAreaChange();
      }

      // Disable the "Import from XML" button if the XML is invalid.
      // Preserve text between page reloads.
      function textAreaChange() {
        var textarea = document.getElementById('importExport');
        if (sessionStorage) {
          sessionStorage.setItem('textarea', textarea.value);
        }
        var valid = true;
        try {
          Blockly.Xml.textToDom(textarea.value);
        } catch (e) {
          valid = false;
        }
        document.getElementById('import').disabled = !valid;
      }

      function logEvents(state) {
        var checkbox = document.getElementById('logCheck');
        checkbox.checked = state;
        if (sessionStorage) {
          sessionStorage.setItem('logEvents', Number(state));
        }
        if (state) {
          workspace.addChangeListener(logger);
        } else {
          workspace.removeChangeListener(logger);
        }
      }

      function logger(e) {
        console.log(e);
        /*if (e.type == Blockly.Events.BLOCK_CHANGE && e.element == 'field') {
          console.log('new value: ', e.newValue);
          /!*console.log('value type: ', typeof e.newValue);*!/
        }*/
      }

      function setAutoUpdate(doAutoUpdating) {
        var checkbox = document.getElementById('auto-update');
        checkbox.checked = doAutoUpdating;
        if (sessionStorage) {
          sessionStorage.setItem('doAutoUpdating', Number(doAutoUpdating));
        }

        var breakDiv = document.getElementById("break");
        var importButton = document.getElementById("import");
        var exportButton = document.getElementById("export");
        if (doAutoUpdating) {
          breakDiv.style.display = 'none';
          importButton.style.display = 'none';
          exportButton.style.display = 'none';

          workspace.addChangeListener(autoUpdater);
        } else {
          breakDiv.style.display = '';
          importButton.style.display = '';
          exportButton.style.display = '';

          workspace.removeChangeListener(autoUpdater);
        }
      }

      function autoUpdater(e) {
        exportWorkspace();
      }

      function airstrike(n) {
        var prototypes = [];
        var toolbox = getToolboxElement();
        var blocks = toolbox.getElementsByTagName('block');
        for (var i = 0, block; block = blocks[i]; i++) {
          prototypes.push(block.getAttribute('type'));
        }
        for (var i = 0; i < n; i++) {
          var prototype = prototypes[Math.floor(Math.random() * prototypes.length)];
          var block = workspace.newBlock(prototype);
          block.initSvg();
          block.getSvgRoot().setAttribute('transform', 'translate(' +
            Math.round(Math.random() * 450 + 40) + ', ' +
            Math.round(Math.random() * 600 + 40) + ')');
          block.render();
        }
      }

      function spaghetti(n) {
        var xml = spaghettiXml;
        for(var i = 0; i < n; i++) {
          xml = xml.replace(/(<(statement|next)( name="DO0")?>)<\//g,
            '$1' + spaghettiXml + '</');
        }
        xml = '<xml xmlns="http://www.w3.org/1999/xhtml">' + xml + '</xml>';
        var dom = Blockly.Xml.textToDom(xml);
        console.time('Spaghetti domToWorkspace');
        Blockly.Xml.domToWorkspace(dom, workspace);
        console.timeEnd('Spaghetti domToWorkspace');
      }
      var spaghettiXml = [
        '  <block type="controls_if">',
        '    <value name="IF0">',
        '      <block type="logic_compare">',
        '        <field name="OP">EQ</field>',
        '        <value name="A">',
        '          <block type="math_arithmetic">',
        '            <field name="OP">MULTIPLY</field>',
        '            <value name="A">',
        '              <block type="math_number">',
        '                <field name="NUM">6</field>',
        '              </block>',
        '            </value>',
        '            <value name="B">',
        '              <block type="math_number">',
        '                <field name="NUM">7</field>',
        '              </block>',
        '            </value>',
        '          </block>',
        '        </value>',
        '        <value name="B">',
        '          <block type="math_number">',
        '            <field name="NUM">42</field>',
        '          </block>',
        '        </value>',
        '      </block>',
        '    </value>',
        '    <statement name="DO0"></statement>',
        '    <next></next>',
        '  </block>'].join('\n');

      function memoryStrike(n) {
        for (var i = 0; i < n; i++) {
          spaghetti(8);
          var blocks = workspace.getBlocksByType('logic_compare');
          for(var j = 0, block; block = blocks[j]; j++) {
            block.removeInput('A');
            block.removeInput('B');
          }
        }
      }

      function miscStressTest(n) {
        n = 250;
        var xml =
          '  <block type="controls_if">' +
          '    <next>' +
          '      <shadow type="text_print"></shadow>' +
          '    </next>' +
          '  </block>';
        xml = Blockly.Xml.textToDom(xml);
        for(var i = 0; i < n; i++) {
          var block = Blockly.Xml.domToBlock(xml, workspace);
          block.dispose();
        }
      }

      // Parse the URL arguments. (And do test-blocks style)
      function parseArguments() {
        // RTL/LTR
        var match = location.search.match(/dir=([^&]+)/);
        var rtl = match && match[1] == 'rtl';
        document.forms.options.elements.dir.selectedIndex = Number(rtl);
        options.rtl = rtl;

        // Toolbox Blocks
        var toolbox = getToolboxElement();
        var toolboxNames = getOpts('.toolbox-opt');
        document.forms.options.elements.toolbox.selectedIndex =
          toolboxNames.indexOf(toolbox.id.slice(8, toolbox.id.length));
        options.toolbox = toolbox;

        // Toolbox Position
        match = location.search.match(/side=([^&]+)/);
        var side = match ? match[1] : 'start';
        document.forms.options.elements.side.value = side;
        options.horizontalLayout = side == 'top' || side == 'bottom';
        options.toolboxPosition = side == 'top' || side == 'start' ? 'start' : 'end';
      }

      function restoreSessionStorage() {
        if (sessionStorage) {

          var text = sessionStorage.getItem('textarea');
          if (text) {
            document.getElementById('importExport').value = text;
          }

          var doEventLogging = sessionStorage.getItem('logEvents');
          logEvents(Boolean(Number(doEventLogging)));

          var doAutoUpdating = sessionStorage.getItem('doAutoUpdating');
          if (doAutoUpdating != null) {
            setAutoUpdate(Boolean(Number(doAutoUpdating)));
          } else {
            setAutoUpdate(true);
          }

          var exportType = sessionStorage.getItem('exportType');
          if (exportType != null) {
            document.getElementById('export-type').value = exportType;
          }

          var theme = sessionStorage.getItem('theme');
          if (theme != null) {
            document.getElementById('themeChanger').value = theme;
          }
        }
      }

      var blockStyles = {
        "colour_blocks":{
          "colourPrimary": "20"
        },
        "list_blocks": {
          "colourPrimary": "260"
        },
        "logic_blocks": {
          "colourPrimary": "210"
        },
        "loop_blocks": {
          "colourPrimary": "120"
        },
        "math_blocks": {
          "colourPrimary": "230"
        },
        "procedure_blocks": {
          "colourPrimary": "290"
        },
        "text_blocks": {
          "colourPrimary": "160"
        },
        "variable_blocks": {
          "colourPrimary": "330"
        },
        "variable_dynamic_blocks":{
          "colourPrimary": "310"
        },
        "hat_blocks":{
          "colourPrimary":"330",
          "hat":"cap"
        },
        "basic": {
          "colourPrimary": "#B32424"
        },
        "fields_defaults": {
          "colourPrimary": "#D69B36"
        },
        "fields_numbers": {
          "colourPrimary": "#3070D9"
        },
        "fields_angles": {
          "colourPrimary": "#B036D9"
        },
        "fields_validators": {
          "colourPrimary": "#36D964"
        },
        "fields_images": {
          "colourPrimary": "#D9C836"
        },
        "fields_emoji": {
          "colourPrimary": "160"
        },
        "fields_dropdowns": {
          "colourPrimary": "#D63636"
        },
        "example_blocks": {
          "colourPrimary": "#369967"
        }
      };

      var categoryStyles = {
        "colour_category": {
          "colour": "20"
        },
        "list_category": {
          "colour": "260"
        },
        "logic_category": {
          "colour": "210"
        },
        "loop_category": {
          "colour": "120"
        },
        "math_category": {
          "colour": "230"
        },
        "procedure_category": {
          "colour": "290"
        },
        "text_category": {
          "colour": "160"
        },
        "variable_category": {
          "colour": "330"
        },
        "variable_dynamic_category": {
          "colour": "310"
        },
        /*saturation=80 vibrancy=70*/
        "basic": {
          "colour": "#B32424"
        },
        "drag": {
          "colour": "#24B38F"
        },
        "fields": {
          "colour": "#8FB324"
        },
        "mutators": {
          "colour": "#243CB3"
        },
        "style": {
          "colour": "#B3246B"
        },
        /*saturation=75, vibrancy=85*/
        "fields_defaults": {
          "colour": "#D69B36"
        },
        "fields_numbers": {
          "colour": "#3070D9"
        },
        "fields_angles": {
          "colour": "#B036D9"
        },
        "fields_validators": {
          "colour": "#36D964"
        },
        "fields_images": {
          "colour": "#D9C836"
        },
        "fields_emoji": {
          "colour": "160"
        },
        "fields_dropdowns": {
          "colour": "#D63636"
        },
        "example_blocks": {
          "colour": "#369967"
        }
      };

      function appendDom() {
        var blocks = document.getElementById('workspace-blocks');
        if (blocks.firstElementChild) {
          Blockly.Xml.appendDomToWorkspace(blocks, workspace);
        }
      }

      function start() {
        parseArguments();
        workspace = Blockly.inject('blocklyDiv', options);
        Blockly.JavaScript.init(workspace);
        workspace.configureContextMenu = configureContextMenu;
        /*addFlyoutCallbacks();*/
        appendDom();
        addToolboxButtonCallbacks();
        restoreSessionStorage();
        textAreaChange();
      }

      var options = {
        theme: new Blockly.Theme(blockStyles, categoryStyles),
        readOnly: false,
        collapse: true,
        comments: true,
        disable: true,
        grid:
          {
            spacing: 25,
            length: 3,
            colour: '#ccc',
            snap: true
          },
        maxBlocks: Infinity,
        maxInstances: {
          'text': 1
        },
        media: '../../media/',
        oneBasedIndex: true,
        move: {
          scrollbars: false,
          drag: true,
          wheel: true,
        },
        zoom:
          {
            controls: true,
            wheel: false,
            startScale: 1.0,
            maxScale: 4,
            minScale: 0.25,
            scaleSpeed: 1.1
          }
      };

      function addFlyoutCallbacks() {
        workspace.registerToolboxCategoryCallback(
            'BLOCK_FLYOUT', Blockly.blockFlyoutCallback);
        workspace.registerToolboxCategoryCallback(
            'PROCEDURE_BLOCK_FLYOUT', Blockly.procedureBlockFlyoutCallback);
      }

      function addToolboxButtonCallbacks() {
        var disclaimer = function(button) {
          var workspace = button.getTargetWorkspace();
          Blockly.Xml.appendDomToWorkspace(Blockly.Xml.textToDom(
            '<xml>' +
            '  <comment h="110" w="190">' +
            'I\'m not promising that all the ideas here are good, ' +
            'some of them are actually pretty bad. I\'m just promising that ' +
            'they\'re interesting.' +
            '  </comment>' +
            '</xml>'
          ), workspace);
        };
        workspace.registerButtonCallback(
          'disclaimer', disclaimer);
        var radBlock = function(button) {
          var workspace = button.getTargetWorkspace();
          Blockly.Xml.appendDomToWorkspace(Blockly.Xml.textToDom(
            '<xml>' +
            '  <block type="example_customization"></block>' +
            '</xml>'
          ), workspace);
        };
        workspace.registerButtonCallback(
          'radBlock', radBlock);

        var addAllBlocksToWorkspace = function(button) {
          var workspace = button.getTargetWorkspace();
          var blocks = button.workspace_.getTopBlocks();
          for(var i = 0, block; block = blocks[i]; i++) {
            var xml = Blockly.Xml.textToDom('<xml></xml>');
            xml.appendChild(Blockly.Xml.blockToDom(block));
            Blockly.Xml.appendDomToWorkspace(xml, workspace);
          }
        };
        var randomizeLabelText = function(button) {
          var blocks = button.targetWorkspace_
            .getBlocksByType('test_fields_label_serializable');
          var possible = 'AB';
          for (var i = 0, block; block = blocks[i]; i++) {
            var text = '';
            for (var j = 0; j < 4; j++) {
              text += possible.charAt(Math.floor(Math.random() * possible.length));
            }
            block.setFieldValue(text, 'LABEL');
          }
        };
        var setRandomStyle = function(button) {
          var blocks = button.workspace_.getAllBlocks();
          var styles = Object.keys(Blockly.getTheme().getAllBlockStyles());
          styles.splice(styles.indexOf(blocks[0].getStyleName()), 1);
          var style = styles[Math.floor(Math.random() * styles.length)];
          for(var i = 0, block; block = blocks[i]; i++) {
            block.setStyle(style);
          }
        };
        var toggleEnabled = function(button) {
          var blocks = button.workspace_.getAllBlocks();
          for(var i = 0, block; block = blocks[i]; i++) {
            block.setEnabled(!block.isEnabled());
          }
        };
        var toggleShadow = function(button) {
          var blocks = button.workspace_.getAllBlocks();
          for(var i = 0, block; block = blocks[i]; i++) {
            block.setShadow(!block.isShadow());
          }
        };
        var toggleCollapsed = function(button) {
          var blocks = button.workspace_.getAllBlocks();
          for(var i = 0, block; block = blocks[i]; i++) {
            block.setCollapsed(!block.isCollapsed());
          }
        };
        var toggleEditable = function(button) {
          var blocks = button.workspace_.getAllBlocks();
          for(var i = 0, block; block = blocks[i]; i++) {
            block.setEditable(!block.isEditable());
          }
        };
        var setRandomOption = function(button) {
          var blocks = button.workspace_.getBlocksByType('test_dropdowns_long');
          for (var i = 0, block; block = blocks[i]; i++) {
            block.setFieldValue('ITEM' + (Math.floor(Math.random() * 31) + 1), 'FIELDNAME');
          }
        };
        var changeImage = function(button) {
          var blocks = button.workspace_.getBlocksByType('test_fields_image');
          var possible = 'abcdefghijklm';
          var image = possible.charAt(Math.floor(Math.random() * possible.length));
          var src = 'https://blockly-demo.appspot.com/static/tests/media/'
              + image + '.png';
          for (var i = 0, block; block = blocks[i]; i++) {
            var imageField = block.getField('IMAGE');
            imageField.setValue(src);
            imageField.setText(image);
          }
        };
        var setTooltip = function(button) {
          var blocks = button.workspace_.getBlocksByType('turtle_basic');
          for (var i = 0, block; block = blocks[i]; i++) {
            block.getField('TURTLE').setTooltip('tooltip');
          }
        };
        var setInput = function(button) {
          Blockly.prompt('Input text to set.', 'ab', function(input) {
            var blocks = button.getTargetWorkspace().getAllBlocks();
            for(var i = 0, block; block = blocks[i]; i++) {
              if (block.getField('INPUT')) {
                block.setFieldValue(input, 'INPUT');
              }
            }
          })
        };
        var addVariables = function(button) {
          workspace.createVariable('1a', '', '1A');
          workspace.createVariable('1b', '', '1B');
          workspace.createVariable('1c', '', '1C');
          workspace.createVariable('2a', '', '2A');
          workspace.createVariable('2b', '', '2B');
          workspace.createVariable('2c', '', '2C');
        };

        workspace.registerButtonCallback(
            'addVariables', addVariables);
        workspace.registerButtonCallback(
          'addAllBlocksToWorkspace', addAllBlocksToWorkspace);
        workspace.registerButtonCallback(
            'setInput', setInput);
        workspace.registerButtonCallback(
            'setTooltip', setTooltip);
        workspace.registerButtonCallback(
            'changeImage', changeImage);
        workspace.registerButtonCallback(
            'setRandomOption', setRandomOption);
        workspace.registerButtonCallback(
            'setRandomStyle', setRandomStyle);
        workspace.registerButtonCallback(
            'toggleEnabled', toggleEnabled);
        workspace.registerButtonCallback(
            'toggleShadow', toggleShadow);
        workspace.registerButtonCallback(
            'toggleCollapsed', toggleCollapsed);
        workspace.registerButtonCallback(
            'toggleEditable', toggleEditable);
        workspace.registerButtonCallback(
            'randomizeLabelText', randomizeLabelText);
        workspace.registerButtonCallback(
            'addDynamicOption', Blockly.TestBlocks.addDynamicDropdownOption_);
        workspace.registerButtonCallback(
            'removeDynamicOption', Blockly.TestBlocks.removeDynamicDropdownOption_);
      }

      function configureContextMenu(options) {
        var addWorkspaceComment = {
          enabled: true,
          text: "Add a Comment",
          callback: function() {
            var xml = Blockly.Xml.textToDom(
              '<xml>' +
              '  <comment>Test</comment>' +
              '</xml>');
            Blockly.Xml.appendDomToWorkspace(xml, workspace);
          }
        };
        options.push(addWorkspaceComment);
      }

    </script>

    <xml id="workspace-blocks" xmlns="http://www.w3.org/1999/xhtml" style="display: none">
    </xml>

    <xml id="toolbox-test-blocks" style="display: none">
      <category name="Basic" categorystyle="basic">
        <block type="test_basic_empty"></block>
        <block type="test_basic_empty_with_mutator"></block>
        <block type="test_basic_value_to_stack"></block>
        <block type="test_basic_value_to_statement"></block>
        <block type="test_basic_limit_instances"></block>
        <block type="test_basic_tooltips"></block>
      </category>
      <category name="Drag" categorystyle="drag">
        <label text="Drag each to the workspace"></label>
        <block type="text_print">
          <value name="TEXT">
            <block type="text">
              <field name="TEXT" value="Drag me by this child"></field>
            </block>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="Drag me by this shadow"></field>
            </shadow>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="Shadow value"></field>
            </shadow>
          </value>
          <next>
            <shadow type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT" value="Shadow statement"></field>
                </shadow>
              </value>
            </shadow>
          </next>
        </block>
        <label text="Multiple Variable Refs"></label>
        <block type="text_print">
          <value name="TEXT">
            <block type="variables_get">
              <field name="VAR" id="item" variablename="item" variabletype=""></field>
            </block>
          </value>
          <next>
            <block type="text_print">
              <value name="TEXT">
                <block type="variables_get">
                  <field name="VAR" id="item" variablename="item" variabletype=""></field>
                </block>
              </value>
            </block>
          </next>
        </block>
        <label text="Procedure Definitions"></label>
        <block type="procedures_defnoreturn">
          <field name="NAME">without arguments</field>
          <statement name="STACK">
            <block type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT" value="No argument reference."></field>
                </shadow>
              </value>
            </block>
          </statement>
        </block>
        <block type="procedures_defnoreturn">
          <mutation>
            <arg name="fnArgument"></arg>
          </mutation>
          <field name="NAME" value="with one argument"></field>
          <statement name="STACK">
            <block type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT" value="Expected an argument reference here."></field>
                </shadow>
                <block type="variables_get">
                  <field name="VAR" variablename="fnArgument"></field>
                </block>
              </value>
            </block>
          </statement>
        </block>
      </category>
      <category name="Fields" categorystyle="fields" expanded="true">
        <category name="Defaults" categorystyle="fields_defaults">
          <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
          <sep gap="8"></sep>
          <button text="set random style" callbackKey="setRandomStyle" web-class="modifiesFlyout"></button>
          <sep gap="8"></sep>
          <button text="toggle enabled" callbackKey="toggleEnabled" web-class="modifiesFlyout"></button>
          <sep gap="8"></sep>
          <button text="toggle shadow" callbackKey="toggleShadow" web-class="modifiesFlyout"></button>
          <sep gap="8"></sep>
          <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
          <sep gap="8"></sep>
          <button text="toggle editable" callbackKey="toggleEditable" web-class="modifiesFlyout"></button>
          <block type="test_fields_angle"></block>
          <block type="test_fields_date"></block>
          <block type="test_fields_checkbox"></block>
          <block type="test_fields_colour"></block>
          <block type="test_fields_colour_options"></block>
          <block type="test_fields_text_input"></block>
          <block type="test_fields_variable">
            <field name="VARIABLE">test</field>
          </block>
          <button text="randomize label text" callbackKey="randomizeLabelText"  web-class="modifiesWorkspace"></button>
          <sep gap="12"></sep>
          <block type="test_fields_label_serializable"></block>
          <button text="change image" callbackKey="changeImage"  web-class="modifiesFlyout"></button>
          <sep gap="12"></sep>
          <block type="test_fields_image"></block>
        </category>
        <category name="Numbers" categorystyle="fields_numbers">
          <block type="test_numbers_float">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_numbers_hundredths">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_numbers_halves">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_numbers_whole">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_numbers_three_halves">
            <field name="NUM">123.456</field>
          </block>
          <block type="test_numbers_whole_bounded">
            <field name="NOTE">60</field>
          </block>
          <block type="test_numbers_constraints_mismatched">
          </block>
        </category>
        <category name="Angles" categorystyle="fields_angles">
          <block type="test_angles_clockwise"></block>
          <block type="test_angles_offset"></block>
          <block type="test_angles_wrap"></block>
          <block type="test_angles_round_30"></block>
          <block type="test_angles_round_0"></block>
          <block type="test_angles_protractor"></block>
          <block type="test_angles_compass"></block>
        </category>
        <category name="Images" categorystyle="fields_images">
          <block type="test_images_datauri"></block>
          <block type="test_images_small"></block>
          <block type="test_images_large"></block>
          <block type="test_images_fliprtl"></block>
          <block type="test_images_missing"></block>
          <block type="test_images_many_icons"></block>
          <block type="test_images_gif"></block>
        </category>
        <category name="Emoji! o((*^á´—^*))o" categorystyle="fields_emoji">
          <label text="Unicode & Emojis"></label>
          <block type="test_style_emoji"></block>
          <block type="text">
            <field name="TEXT">Robot face in text field: &#x1f916;</field>
          </block>
          <block type="text">
            <field name="TEXT">Zalgo in text field: B&#776;&#788;&#862;&#795;&#842;&#827;&#806;&#837;&#812;&#792;&#816;&#846;&#805;l&#771;&#832;&#833;&#864;&#849;&#849;&#789;&#861;&#801;&#854;&#863;&#811;&#826;&#812;&#790;&#803;&#819;o&#843;&#777;&#778;&#785;&#831;&#829;&#794;&#825;&#857;&#814;&#802;&#811;&#852;c&#843;&#786;&#849;&#778;&#861;&#775;&#825;&#825;&#796;&#857;&#825;&#800;&#824;k&#778;&#850;&#833;&#774;&#772;&#782;&#862;&#770;&#789;&#788;&#841;&#801;&#811;&#860;&#839;&#790;&#819;&#854;l&#832;&#774;&#836;&#831;&#776;&#787;&#855;&#816;&#793;&#798;&#819;&#809;&#800;&#854;&#815;y&#864;&#783;&#856;&#773;&#832;&#808;&#799;&#839;&#814;&#840;&#812;&#793;&#818;&#801;</field>
          </block>
        </category>
        <category name="Drop-downs" categorystyle="fields_dropdowns">
          <label text="Dynamic"></label>
          <sep gap=8></sep>
          <button text="add option" callbackKey="addDynamicOption"></button>
          <sep gap=8></sep>
          <button text="remove option" callbackKey="removeDynamicOption"></button>
          <block type="test_dropdowns_dynamic"></block>
          <label text="Other"></label>
          <sep gap=8></sep>
          <button text="set random option" callbackKey="setRandomOption" web-class="modifiesFlyout"></button>
          <block type="test_dropdowns_long"></block>
          <block type="test_dropdowns_images"></block>
          <block type="test_dropdowns_images_and_text"></block>
        </category>
        <category name="Validators" categorystyle="fields_validators">
          <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
          <sep gap="8"></sep>
          <button text="set input" callbackKey="setInput" web-class="modifiesWorkspace"></button>
          <label text="Angles"></label>
          <sep gap="12"></sep>
          <block type="test_validators_angle_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_angle_mult30_force"></block>
          <sep gap="12"></sep>
          <block type="test_validators_angle_mult30_null"></block>
          <label text="Checkboxes"></label>
          <sep gap="12"></sep>
          <block type="test_validators_checkbox_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_checkbox_match"></block>
          <sep gap="12"></sep>
          <block type="test_validators_checkbox_not_match_null"></block>
          <label text="Colours"></label>
          <sep gap="12"></sep>
          <block type="test_validators_colour_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_colour_force_red"></block>
          <sep gap="12"></sep>
          <block type="test_validators_colour_red_null"></block>
          <label text="Dates"></label>
          <sep gap="12"></sep>
          <block type="test_validators_date_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_date_force_20s"></block>
          <sep gap="12"></sep>
          <block type="test_validators_date_20s_null"></block>
          <label text="Dropdowns"></label>
          <sep gap="12"></sep>
          <block type="test_validators_dropdown_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_dropdown_force_1s"></block>
          <sep gap="12"></sep>
          <block type="test_validators_dropdown_1s_null"></block>
          <label text="Numbers"></label>
          <sep gap="12"></sep>
          <block type="test_validators_number_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_number_mult10_force"></block>
          <sep gap="12"></sep>
          <block type="test_validators_number_mult10_null"></block>
          <label text="Text"></label>
          <sep gap="12"></sep>
          <block type="test_validators_text_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_text_A"></block>
          <sep gap="12"></sep>
          <block type="test_validators_text_B"></block>
          <label text="Variables"></label>
          <sep gap="8"></sep>
          <button text="add test variables" callbackKey="addVariables" web-class="modifiesWorkspace"></button>
          <sep gap="12"></sep>
          <block type="test_validators_variable_null"></block>
          <sep gap="12"></sep>
          <block type="test_validators_variable_force_1s"></block>
          <sep gap="12"></sep>
          <block type="test_validators_variable_1s_null"></block>
        </category>
      </category>
      <category name="Mutators" categorystyle="mutators">
        <label text="logic_compare"></label>
        <block type="logic_compare">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
        </block>
        <block type="logic_compare">
          <value name="A">
            <block type="math_number">
              <field name="NUM" value="10"></field>
            </block>
          </value>
          <value name="B">
            <block type="math_number">
              <field name="NUM" value="10"></field>
            </block>
          </value>
        </block>
      </category>
      <category name="Style" categorystyle="style">
        <label text="Hats"></label>
        <block type="test_style_hat"></block>
        <label text="Colour"></label>
        <block type="test_style_hex1"></block>
        <block type="test_style_hex2"></block>
        <block type="test_style_hex3"></block>
        <block type="test_style_no_colour"></block>
        <block type="test_style_hex4"></block>
        <block type="test_style_hex5"></block>
      </category>
    </xml>

    <xml id="toolbox-simple" style="display: none">
      <block type="controls_ifelse"></block>
      <block type="logic_compare" editable="false"></block>
      <block type="controls_repeat"></block>
      <block type="logic_operation"></block>
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM" value="10"></field>
          </shadow>
        </value>
      </block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null" disabled="true"></block>
      <block type="logic_ternary"></block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR" variablename="text"></field>
          </block>
        </value>
      </block>
    </xml>

    <xml id="toolbox-categories" style="display: none">
      <category name="Logic" categorystyle="logic_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="controls_if"></block>
        <block type="controls_ifelse"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null" disabled="true"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" categorystyle="loop_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
        </block>
        <block type="controls_repeat" disabled="true"></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math" categorystyle="math_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="math_number" gap="32">
          <field name="NUM" value="123"></field>
        </block>
        <block type="math_arithmetic">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="9"></field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="45"></field>
            </shadow>
          </value>
        </block>
        <block type="math_constant"></block>
        <block type="math_number_property">
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM" value="0"></field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="3.1"></field>
            </shadow>
          </value>
        </block>
        <block type="math_on_list"></block>
        <block type="math_modulo">
          <value name="DIVIDEND">
            <shadow type="math_number">
              <field name="NUM" value="64"></field>
            </shadow>
          </value>
          <value name="DIVISOR">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
        </block>
        <block type="math_constrain">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM" value="50"></field>
            </shadow>
          </value>
          <value name="LOW">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="HIGH">
            <shadow type="math_number">
              <field name="NUM" value="100"></field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM" value="100"></field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
        <block type="math_atan2">
          <value name="X">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Text" categorystyle="text_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="text"></field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="text"></field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <value name="STRING">
            <block type="variables_get">
              <field name="VAR" value="text">text</field>
            </block>
          </value>
        </block>
        <block type="text_changeCase">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_trim">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_count">
          <value name="SUB">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_replace">
          <value name="FROM">
            <shadow type="text"></shadow>
          </value>
          <value name="TO">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_reverse">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <label text="Input/Output:" web-class="ioLabel"></label>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Lists" categorystyle="list_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="5"></field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_split">
          <value name="DELIM">
          </value>
        </block>
        <block type="lists_sort"></block>
        <block type="lists_reverse"></block>
      </category>
      <category name="Colour" categorystyle="colour_category">
        <button text="import" callbackKey="addAllBlocksToWorkspace" web-class="modifiesWorkspace"></button>
        <button text="toggle collapsed" callbackKey="toggleCollapsed" web-class="modifiesFlyout"></button>
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
          <value name="RED">
            <shadow type="math_percent">
              <field name="NUM">100</field>
            </shadow>
          </value>
          <value name="GREEN">
            <shadow type="math_percent">
              <field name="NUM">50</field>
            </shadow>
          </value>
          <value name="BLUE">
            <shadow type="math_percent">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="colour_blend">
          <value name="COLOUR1">
            <shadow type="colour_picker">
              <field name="COLOUR" value="#ff0000"></field>
            </shadow>
          </value>
          <value name="COLOUR2">
            <shadow type="colour_picker">
              <field name="COLOUR" value="#3333ff"></field>
            </shadow>
          </value>
          <value name="RATIO">
            <shadow type="math_number">
              <field name="NUM" value="0.5">0.5</field>
            </shadow>
          </value>
        </block>
      </category>
      <sep></sep>
      <category name="Variables" categorystyle="variable_category" custom="VARIABLE"></category>
      <category name="Functions" categorystyle="procedure_category" custom="PROCEDURE"></category>
    </xml>

    <xml id="toolbox-categories-typed-variables" style="display: none">
      <category name="Logic" categorystyle="logic_category">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null" disabled="true"></block>
        <block type="logic_ternary"></block>
      </category>
      <category name="Loops" categorystyle="loop_category">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
        </block>
        <block type="controls_repeat" disabled="true"></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <category name="Math" categorystyle="math_category">
        <block type="math_number" gap="32">
          <field name="NUM" value="123"></field>
        </block>
        <block type="math_arithmetic">
          <value name="A">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="9"></field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="45"></field>
            </shadow>
          </value>
        </block>
        <block type="math_constant"></block>
        <block type="math_number_property">
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM" value="0"></field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="3.1"></field>
            </shadow>
          </value>
        </block>
        <block type="math_on_list"></block>
        <block type="math_modulo">
          <value name="DIVIDEND">
            <shadow type="math_number">
              <field name="NUM" value="64"></field>
            </shadow>
          </value>
          <value name="DIVISOR">
            <shadow type="math_number">
              <field name="NUM" value="10"></field>
            </shadow>
          </value>
        </block>
        <block type="math_constrain">
          <value name="VALUE">
            <shadow type="math_number">
              <field name="NUM" value="50"></field>
            </shadow>
          </value>
          <value name="LOW">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="HIGH">
            <shadow type="math_number">
              <field name="NUM" value="100"></field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM" value="100"></field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
        <block type="math_atan2">
          <value name="X">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
          <value name="Y">
            <shadow type="math_number">
              <field name="NUM" value="1"></field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Text" categorystyle="text_category">
        <block type="text"></block>
        <block type="text_multiline"></block>
        <block type="text_join"></block>
        <block type="text_append">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_length">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="text"></field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_charAt">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="text"></field>
            </block>
          </value>
        </block>
        <block type="text_getSubstring">
          <value name="STRING">
            <block type="variables_get">
              <field name="VAR" value="text">text</field>
            </block>
          </value>
        </block>
        <block type="text_changeCase">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_trim">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_count">
          <value name="SUB">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_replace">
          <value name="FROM">
            <shadow type="text"></shadow>
          </value>
          <value name="TO">
            <shadow type="text"></shadow>
          </value>
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="text_reverse">
          <value name="TEXT">
            <shadow type="text"></shadow>
          </value>
        </block>
        <label text="Input/Output:" web-class="ioLabel"></label>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT" value="abc"></field>
            </shadow>
          </value>
        </block>
      </category>
      <category name="Lists" categorystyle="list_category">
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM" value="5"></field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_setIndex">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" variablename="list"></field>
            </block>
          </value>
        </block>
        <block type="lists_split">
          <value name="DELIM">
            <shadow type="text">
              <field name="TEXT" value=","></field>
            </shadow>
          </value>
        </block>
        <block type="lists_sort"></block>
        <block type="lists_reverse"></block>
      </category>
      <category name="Colour" categorystyle="colour_category">
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
          <value name="RED">
            <shadow type="math_number">
              <field name="NUM" value="100"></field>
            </shadow>
          </value>
          <value name="GREEN">
            <shadow type="math_number">
              <field name="NUM" value="50"></field>
            </shadow>
          </value>
          <value name="BLUE">
            <shadow type="math_number">
              <field name="NUM" value="0">0</field>
            </shadow>
          </value>
        </block>
        <block type="colour_blend">
          <value name="COLOUR1">
            <shadow type="colour_picker">
              <field name="COLOUR" value="#ff0000"></field>
            </shadow>
          </value>
          <value name="COLOUR2">
            <shadow type="colour_picker">
              <field name="COLOUR" value="#3333ff"></field>
            </shadow>
          </value>
          <value name="RATIO">
            <shadow type="math_number">
              <field name="NUM" value="0.5">0.5</field>
            </shadow>
          </value>
        </block>
      </category>
      <sep></sep>
      <category name="Variables" categorystyle="variable_category" custom="VARIABLE_DYNAMIC"></category>
      <category name="Functions" categorystyle="procedure_category" custom="PROCEDURE"></category>
    </xml>

    <xml id="toolbox-summit-fields" style="display: none">
      <button text="Disclaimer!" callbackkey="disclaimer"></button>
      <sep gap="8"></sep>
      <button text="Rad Block" callbackkey="radBlock"></button>

      <label text="That View"></label>
      <sep gap="8"></sep>
      <block type="example_flyout"></block>
      <sep gap="8"></sep>
      <block type="example_map"></block>

      <label text="Those Events"></label>
      <sep gap="8"></sep>
      <block type="example_percent"></block>
      <sep gap="8"></sep>
      <block type="example_flyout"></block>
      <sep gap="8"></sep>
      <block type="example_flyout_broken"></block>

      <label text="Text Elements"></label>
      <sep gap="8"></sep>
      <block type="example_percent"></block>
      <sep gap="8"></sep>
      <block type="example_flyout"></block>
      <sep gap="8"></sep>
      <block type="example_dropdown"></block>

      <label text="Tooltipz"></label>
      <sep gap="8"></sep>
      <block type="example_tooltips" collapsed="true"></block>
      <sep gap="8"></sep>
      <block type="example_tooltip_hiding"></block>
      <sep gap="8"></sep>
      <block type="example_tooltip_dynamic"></block>

      <label text="Validatin' n' Mutatin'"></label>
      <sep gap="8"></sep>
      <block type="math_number_property"></block>
      <sep gap="8"></sep>
      <block type="example_mutator"></block>

      <label text="Cooler Validators"></label>
      <sep gap="8"></sep>
      <block type="example_text_alphabet"></block>
      <sep gap="8"></sep>
      <block type="example_number_parity"></block>
      <sep gap="8"></sep>
      <block type="example_date_null"></block>
      <sep gap="8"></sep>
      <block type="example_text_null"></block>

      <label text="Multipart Values"></label>
      <sep gap="8"></sep>
      <block type="turtle_basic"></block>
      <sep gap="8"></sep>
      <block type="turtle_nullifier"></block>



      <sep gap="48"></sep>
      <label text="Backwards Compat"></label>
      <sep gap="8"></sep>
      <block type="example_compat_colour">
        <comment pinned="true" h="50" w="130">Colour Broken? Issue: #1858
        </comment>
      </block>
      <label text="Language Neutrality"></label>
      <sep gap="8"></sep>
      <block type="example_map"></block>
    </xml>
  </body>
</html>
